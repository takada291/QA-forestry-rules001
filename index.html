<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ä¼æ¡å±Šå‡º QAã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆ</title>
    <style>
        /* å…¨ä½“ã®ã‚·ãƒ³ãƒ—ãƒ«ãªãƒ‡ã‚¶ã‚¤ãƒ³ */
        body {
            font-family: 'Helvetica Neue', Arial, sans-serif;
            background-color: #f4f7f6;
            color: #333;
            max-width: 600px;
            margin: 0 auto;
            padding: 20px;
        }
        .container {
            background-color: #fff;
            padding: 25px;
            border-radius: 8px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        h1 {
            font-size: 1.4em;
            color: #2c3e50;
            text-align: center;
            margin-bottom: 20px;
            border-bottom: 2px solid #27ae60;
            padding-bottom: 10px;
        }
        .input-group {
            margin-bottom: 20px;
        }
        label {
            display: block;
            font-weight: bold;
            margin-bottom: 8px;
            color: #2c3e50;
        }
        input[type="password"], textarea {
            width: 100%;
            padding: 12px;
            border: 1px solid #ccc;
            border-radius: 4px;
            box-sizing: border-box;
            font-size: 1em;
        }
        textarea {
            resize: vertical;
            height: 100px;
        }
        .note {
            font-size: 0.8em;
            color: #7f8c8d;
            margin-top: 5px;
        }
        button {
            background-color: #27ae60;
            color: white;
            border: none;
            padding: 14px 20px;
            font-size: 1.1em;
            font-weight: bold;
            border-radius: 4px;
            cursor: pointer;
            width: 100%;
            transition: background-color 0.3s;
        }
        button:hover {
            background-color: #219150;
        }
        button:disabled {
            background-color: #95a5a6;
            cursor: not-allowed;
        }
        #loading {
            display: none;
            text-align: center;
            color: #27ae60;
            font-weight: bold;
            margin-top: 15px;
        }
        #result-area {
            display: none;
            margin-top: 25px;
            padding: 20px;
            background-color: #e8f8f5;
            border-left: 5px solid #1abc9c;
            border-radius: 4px;
            white-space: pre-wrap; /* æ”¹è¡Œã‚’ãã®ã¾ã¾è¡¨ç¤º */
            line-height: 1.6;
        }
        .disclaimer {
            font-size: 0.85em;
            color: #e74c3c;
            margin-top: 20px;
            text-align: center;
            font-weight: bold;
        }
    </style>
</head>
<body>

<div class="container">
    <h1>ğŸŒ² ä¼æ¡å±Šå‡º QAã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆ</h1>

    <div class="input-group">
        <label for="apiKey">Gemini APIã‚­ãƒ¼</label>
        <input type="password" id="apiKey" placeholder="AI Studioã§å–å¾—ã—ãŸAPIã‚­ãƒ¼ã‚’å…¥åŠ›">
        <div class="note">â€»ä¸€åº¦å…¥åŠ›ã™ã‚‹ã¨ãƒ–ãƒ©ã‚¦ã‚¶ã«ä¿å­˜ã•ã‚Œã¾ã™ã€‚</div>
    </div>

    <div class="input-group">
        <label for="question">ã”è³ªå•å†…å®¹</label>
        <textarea id="question" placeholder="ä¾‹ï¼šé–“ä¼ã§ã‚‚å±Šå‡ºã¯å¿…è¦ã§ã™ã‹ï¼Ÿ"></textarea>
    </div>

    <button id="submitBtn" onclick="askAI()">AIã«è³ªå•ã™ã‚‹</button>

    <div id="loading">å›ç­”ã‚’ç”Ÿæˆä¸­... å°‘ã€…ãŠå¾…ã¡ãã ã•ã„ã€‚</div>

    <div id="result-area"></div>

    <div class="disclaimer">
        â€»æœ¬AIã¯æ—é‡åºã®å…¬é–‹è³‡æ–™ã«åŸºã¥ã„ã¦å›ç­”ã—ã¾ã™ãŒã€æœ€çµ‚çš„ãªåˆ¤æ–­ãƒ»æ‰‹ç¶šãã«ã¤ã„ã¦ã¯å¿…ãšå¸‚ç”ºæ‘ã®æ—å‹™æ‹…å½“çª“å£ã¸ã”ç¢ºèªãã ã•ã„ã€‚
    </div>
</div>

<script>
    // ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿æ™‚ã«ã€ä¿å­˜ã•ã‚ŒãŸAPIã‚­ãƒ¼ãŒã‚ã‚Œã°å¾©å…ƒã™ã‚‹
    window.onload = function() {
        const savedKey = localStorage.getItem('gemini_api_key_forestry');
        if (savedKey) {
            document.getElementById('apiKey').value = savedKey;
        }
    };

    async function askAI() {
        const apiKey = document.getElementById('apiKey').value.trim();
        const question = document.getElementById('question').value.trim();
        const submitBtn = document.getElementById('submitBtn');
        const loading = document.getElementById('loading');
        const resultArea = document.getElementById('result-area');

        // å…¥åŠ›ãƒã‚§ãƒƒã‚¯
        if (!apiKey) {
            alert("APIã‚­ãƒ¼ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚");
            return;
        }
        if (!question) {
            alert("è³ªå•å†…å®¹ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚");
            return;
        }

        // APIã‚­ãƒ¼ã‚’ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã«ä¿å­˜
        localStorage.setItem('gemini_api_key_forestry', apiKey);

        // UIã®çŠ¶æ…‹ã‚’ã€Œé€šä¿¡ä¸­ã€ã«å¤‰æ›´
        submitBtn.disabled = true;
        loading.style.display = 'block';
        resultArea.style.display = 'none';
        resultArea.innerText = '';

        try {
            // 1. GitHubã‹ã‚‰2ã¤ã®ãƒ«ãƒ¼ãƒ«ï¼ˆãƒãƒ¼ã‚¯ãƒ€ã‚¦ãƒ³ï¼‰ã‚’èª­ã¿è¾¼ã‚€
            // â˜…æ³¨æ„ï¼šä»¥ä¸‹ã®ãƒ•ã‚¡ã‚¤ãƒ«åã®éƒ¨åˆ†ã‚’ã€å®Ÿéš›ã®åå‰ã«æ›¸ãæ›ãˆã¦ãã ã•ã„ï¼
            const mdUrl1 = 'https://raw.githubusercontent.com/takada291/QA-forestry-rules001/refs/heads/main/rules001-001.md';
            const mdUrl2 = 'https://raw.githubusercontent.com/takada291/QA-forestry-rules001/refs/heads/main/rules001-002.md';

            // 2ã¤ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä¸¦åˆ—ã§åŒæ™‚ã«èª­ã¿è¾¼ã‚€
            const [mdResponse1, mdResponse2] = await Promise.all([
                fetch(mdUrl1),
                fetch(mdUrl2)
            ]);

            if (!mdResponse1.ok || !mdResponse2.ok) {
                throw new Error("ãƒ«ãƒ¼ãƒ«ãƒ•ã‚¡ã‚¤ãƒ«ã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸã€‚ãƒ•ã‚¡ã‚¤ãƒ«åãŒé–“é•ã£ã¦ã„ãªã„ã‹ç¢ºèªã—ã¦ãã ã•ã„ã€‚");
            }

            const ruleText1 = await mdResponse1.text();
            const ruleText2 = await mdResponse2.text();

            // 2. ã‚·ã‚¹ãƒ†ãƒ æŒ‡ç¤ºã‚’æ§‹ç¯‰ï¼ˆ2ã¤ã®ãƒãƒ‹ãƒ¥ã‚¢ãƒ«ã‚’åˆä½“ï¼‰
            const systemInstruction = `
ã‚ãªãŸã¯æ—é‡åºã®ä¼æ¡å±Šå‡ºã«é–¢ã™ã‚‹å„ªç§€ãªè¡Œæ”¿ã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆã§ã™ã€‚
ä»¥ä¸‹ã®ã€åŸºæœ¬ãƒãƒ‹ãƒ¥ã‚¢ãƒ«ã€‘ã¨ã€è©³ç´°Q&Aãƒ»ä¾‹å¤–ãƒ«ãƒ¼ãƒ«ã€‘ã®å†…å®¹ã®ã¿ã‚’æƒ…å ±æºã¨ã—ã¦ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®è³ªå•ã«æ­£ç¢ºã«ç­”ãˆã¦ãã ã•ã„ã€‚

ã€å³å®ˆã™ã‚‹ãƒ«ãƒ¼ãƒ«ã€‘
- æä¾›ã•ã‚ŒãŸè³‡æ–™ã«è¨˜è¼‰ã•ã‚Œã¦ã„ã‚‹äº‹å®Ÿã®ã¿ã‚’å›ç­”ã™ã‚‹ã“ã¨ã€‚
- è³‡æ–™ã«è¨˜è¼‰ãŒãªã„å ´åˆã€çµ¶å¯¾ã«æ¨æ¸¬ã‚„ä¸€èˆ¬è«–ã§å›ç­”ã›ãšã€ã€Œæä¾›ã•ã‚ŒãŸãƒãƒ‹ãƒ¥ã‚¢ãƒ«ã«ã¯è¨˜è¼‰ãŒãªã„ãŸã‚ã€å¸‚ç”ºæ‘ã®æ‹…å½“çª“å£ã«ã”ç¢ºèªãã ã•ã„ã€ã¨å›ç­”ã™ã‚‹ã“ã¨ã€‚
- ä¿å®‰æ—ã‚„æ—åœ°é–‹ç™ºãªã©ã€ä¼æ¡å±Šä»¥å¤–ã®åˆ¶åº¦ãŒçµ¡ã‚€ä¾‹å¤–ã‚±ãƒ¼ã‚¹ã«ã¤ã„ã¦ã¯ç‰¹ã«æ³¨æ„æ·±ãè³‡æ–™ã‚’ç¢ºèªã™ã‚‹ã“ã¨ã€‚
- å›ç­”ã¯åˆ†ã‹ã‚Šã‚„ã™ãã€ä¸å¯§ãªãƒˆãƒ¼ãƒ³ã§è¡Œã†ã“ã¨ã€‚

ã€åŸºæœ¬ãƒãƒ‹ãƒ¥ã‚¢ãƒ«ã€‘
${ruleText1}

ã€è©³ç´°Q&Aãƒ»ä¾‹å¤–ãƒ«ãƒ¼ãƒ«ã€‘
${ruleText2}
`;

            // 3. Gemini API (v1beta) ã¸ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’é€ä¿¡
            const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash:generateContent?key=${apiKey}`;
            const requestBody = {
                system_instruction: { parts: [{ text: systemInstruction }] },
                contents: [{ parts: [{ text: question }] }]
            };

            const apiResponse = await fetch(apiUrl, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(requestBody)
            });

            if (!apiResponse.ok) {
                const errorData = await apiResponse.json();
                throw new Error("APIã‚¨ãƒ©ãƒ¼: " + (errorData.error?.message || "ä¸æ˜ãªã‚¨ãƒ©ãƒ¼"));
            }

            const data = await apiResponse.json();

            // 4. å›ç­”ã‚’è¡¨ç¤º
            if (data.candidates && data.candidates.length > 0) {
                const answer = data.candidates[0].content.parts[0].text;
                resultArea.innerText = answer;
                resultArea.style.display = 'block';
            } else {
                throw new Error("APIã‹ã‚‰æœ‰åŠ¹ãªå›ç­”ãŒè¿”ã£ã¦ãã¾ã›ã‚“ã§ã—ãŸã€‚");
            }

        } catch (error) {
            console.error(error);
            alert("ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ: " + error.message);
        } finally {
            // UIã®çŠ¶æ…‹ã‚’å…ƒã«æˆ»ã™
            submitBtn.disabled = false;
            loading.style.display = 'none';
        }
    }
</script>

</body>
</html>
